<ion-header>
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-back-button></ion-back-button>
    </ion-buttons>
    <ion-title>Crear Nueva Tarea</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content>
  <div class="px-4 py-6 bg-gray-50 dark:bg-gray-900 min-h-screen transition-colors">
  <ion-card
    class="p-6 rounded-2xl shadow-sm bg-slate-100 dark:bg-gray-800 border border-gray-100 dark:border-gray-700"
  >
    <!-- TÍTULO -->
    <div class="mb-6">
      <div class="flex items-center justify-between mb-2">
        <p class="text-xs font-semibold text-gray-400 dark:text-gray-500 tracking-wide">
          TÍTULO *
        </p>
        <span class="text-xs" 
              [ngClass]="title.trim().length > titleMaxLength ? 'text-red-500' : 'text-gray-400 dark:text-gray-500'">
          {{ title.trim().length }}/{{ titleMaxLength }}
        </span>
      </div>

      <ion-item
        lines="none"
        class="rounded-xl bg-gray-50 dark:bg-gray-700 border transition-colors"
        [ngClass]="titleTouched && !isTitleValid 
          ? 'border-red-500 dark:border-red-500' 
          : 'border-gray-200 dark:border-gray-600'"
      >
        <ion-input
          placeholder="Añade un título (mínimo 3 caracteres)"
          [(ngModel)]="title"
          (ionBlur)="onTitleBlur()"
          [maxlength]="titleMaxLength"
          class="text-gray-900 dark:text-black ion-input-dark"
        ></ion-input>
      </ion-item>
      
      @if (titleTouched && !isTitleValid) {
        <p class="text-xs text-red-500 mt-2 ml-1">
          @if (title.trim().length < titleMinLength) {
            El título debe tener al menos {{ titleMinLength }} caracteres
          } @else if (title.trim().length > titleMaxLength) {
            El título no puede exceder {{ titleMaxLength }} caracteres
          }
        </p>
      }
    </div>

    <!-- DESCRIPCIÓN -->
    <div class="">
      <div class="flex items-center justify-between mb-2">
        <p class="text-xs font-semibold text-gray-400 dark:text-gray-500 tracking-wide">
          DESCRIPCIÓN (OPCIONAL)
        </p>
        <span class="text-xs" 
              [ngClass]="descripcion.trim().length > descripcionMaxLength ? 'text-red-500' : 'text-gray-400 dark:text-gray-500'">
          {{ descripcion.trim().length }}/{{ descripcionMaxLength }}
        </span>
      </div>

      <ion-item
        lines="none"
        class="rounded-xl bg-gray-50 dark:bg-gray-700 border transition-colors"
        [ngClass]="!isDescripcionValid 
          ? 'border-red-500 dark:border-red-500' 
          : 'border-gray-200 dark:border-gray-600'"
      >
        <ion-textarea
          rows="4"
          placeholder="Añade más detalles sobre esta tarea..."
          [(ngModel)]="descripcion"
          [maxlength]="descripcionMaxLength"
          class=" text-gray-900 dark:text-black ion-input-dark"
        ></ion-textarea>
      </ion-item>
      
      @if (!isDescripcionValid) {
        <p class="text-xs text-red-500 mt-2 ml-1">
          La descripción no puede exceder {{ descripcionMaxLength }} caracteres
        </p>
      }

      <!-- FECHA -->
      <div class="mb-6 mt-6">
        <p class="text-xs font-semibold text-gray-400 dark:text-gray-500 mb-2 tracking-wide">
          FECHA (OPCIONAL)
        </p>

        <ion-item
          lines="none"
          class="rounded-xl bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600"
        >
        <ion-icon
          name="calendar-outline"
          slot="start"
          class="text-gray-500 dark:text-gray-400"
        ></ion-icon>
          <ion-datetime-button
            datetime="taskDate"
            class="datetime-clean"
          ></ion-datetime-button>
        </ion-item>
      </div>

      <ion-modal keep-contents-mounted="true">
        <ng-template>
          <ion-datetime
            id="taskDate"
            presentation="date"
            [(ngModel)]="date"
          ></ion-datetime>
        </ng-template>
      </ion-modal>

      <ion-button
        expand="block"
        [disabled]="!canSubmit"
        class="mt-6 text-white rounded-lg flex items-center justify-center transition-opacity"
        [ngClass]="!canSubmit ? 'opacity-50 cursor-not-allowed' : ''"
        (click)="createTask()"
      >
        <ion-icon slot="start" name="checkmark-circle-outline"></ion-icon>
        Crear Tarea
      </ion-button>
    </div>
  </ion-card>
  </div>
</ion-content>
